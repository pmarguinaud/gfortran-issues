MODULE FIELD_3IM_MODULE


USE FIELD_BASIC_MODULE
USE PARKIND1, ONLY : JPRM, JPRB, JPRD, JPIM, JPLM

IMPLICIT NONE

PRIVATE

INTEGER (KIND=JPIM), PARAMETER :: NDEVFRESH = INT(B'00000001', KIND=JPIM)
INTEGER (KIND=JPIM), PARAMETER :: NHSTFRESH = INT(B'00000010', KIND=JPIM)
INTEGER (KIND=JPIM), PARAMETER :: UNALLOCATED = INT(B'00000100', KIND=JPIM)
INTEGER (KIND=JPIM), PARAMETER :: NH2D = 1, ND2H = 2
INTEGER (KIND=JPIM), PARAMETER :: NRD = INT(B'00000001', KIND=JPIM)
INTEGER (KIND=JPIM), PARAMETER :: NWR = INT(B'00000010', KIND=JPIM)

TYPE, ABSTRACT, EXTENDS (FIELD_BASIC) :: FIELD_3IM
  INTEGER(KIND=JPIM), POINTER :: PTR(:,:,:) => NULL()
  INTEGER(KIND=JPIM), POINTER, CONTIGUOUS :: DEVPTR(:,:,:) => NULL()
CONTAINS

  PROCEDURE :: FINAL => FIELD_3IM_FINAL
  PROCEDURE :: FIELD_3IM_FINAL
  PROCEDURE :: DELETE_DEVICE => FIELD_3IM_DELETE_DEVICE
  PROCEDURE :: GET_VIEW => FIELD_3IM_GET_VIEW
  PROCEDURE :: GET_DEVICE_DATA_RDONLY => FIELD_3IM_GET_DEVICE_DATA_RDONLY
  PROCEDURE :: GET_DEVICE_DATA_RDWR => FIELD_3IM_GET_DEVICE_DATA_RDWR
  PROCEDURE :: GET_HOST_DATA_RDONLY => FIELD_3IM_GET_HOST_DATA_RDONLY
  PROCEDURE :: GET_HOST_DATA_RDWR => FIELD_3IM_GET_HOST_DATA_RDWR
  PROCEDURE :: SYNC_HOST_RDWR => FIELD_3IM_SYNC_HOST_RDWR
  PROCEDURE :: SYNC_HOST_RDONLY => FIELD_3IM_SYNC_HOST_RDONLY
  PROCEDURE :: SYNC_DEVICE_RDWR => FIELD_3IM_SYNC_DEVICE_RDWR
  PROCEDURE :: SYNC_DEVICE_RDONLY => FIELD_3IM_SYNC_DEVICE_RDONLY
  PROCEDURE :: COPY_OBJECT => FIELD_3IM_COPY_OBJECT
  PROCEDURE :: WIPE_OBJECT => FIELD_3IM_WIPE_OBJECT

  PROCEDURE, PRIVATE :: GET_DEVICE_DATA => FIELD_3IM_GET_DEVICE_DATA
  PROCEDURE, PRIVATE :: GET_HOST_DATA => FIELD_3IM_GET_HOST_DATA
  PROCEDURE, PRIVATE :: FIELD_3IM_GET_HOST_DATA
  PROCEDURE, PRIVATE :: COPY_DATA =>  FIELD_3IM_COPY_DATA
  PROCEDURE, PRIVATE :: CREATE_DEVICE_DATA => FIELD_3IM_CREATE_DEVICE_DATA
END TYPE FIELD_3IM

PUBLIC :: FIELD_3IM

TYPE, EXTENDS(FIELD_3IM) :: FIELD_3IM_WRAPPER
CONTAINS
  PROCEDURE :: INIT => FIELD_3IM_WRAP
  PROCEDURE :: FINAL => FIELD_3IM_WRAPPER_FINAL
END TYPE FIELD_3IM_WRAPPER

PUBLIC :: FIELD_3IM_WRAPPER

TYPE, EXTENDS(FIELD_3IM) :: FIELD_3IM_OWNER
  INTEGER(KIND=JPIM) :: LBOUNDS(3), UBOUNDS(3)
CONTAINS
  PROCEDURE :: INIT => FIELD_3IM_OWNER_INIT
  PROCEDURE :: FINAL => FIELD_3IM_OWNER_FINAL
  PROCEDURE, PRIVATE :: ALLOCATE => FIELD_3IM_ALLOCATE
  PROCEDURE, PRIVATE :: GET_HOST_DATA => FIELD_3IM_OWNER_GET_HOST_DATA
END TYPE FIELD_3IM_OWNER

PUBLIC :: FIELD_3IM_OWNER

TYPE FIELD_3IM_PTR
  CLASS(FIELD_3IM), POINTER :: PTR => NULL()
END TYPE FIELD_3IM_PTR

PUBLIC :: FIELD_3IM_PTR

TYPE FIELD_3IM_VIEW
  INTEGER(KIND=JPIM), POINTER :: P(:,:) => NULL()
END TYPE FIELD_3IM_VIEW

PUBLIC :: FIELD_3IM_VIEW


CONTAINS

  SUBROUTINE FIELD_3IM_WRAP(SELF, DATA, PERSISTENT, LBOUNDS)
    
    CLASS(FIELD_3IM_WRAPPER), INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), TARGET, INTENT(IN) :: DATA(:,:,:)
    LOGICAL, INTENT(IN), OPTIONAL :: PERSISTENT
    INTEGER(KIND=JPIM), INTENT(IN), OPTIONAL :: LBOUNDS(3)
    LOGICAL :: LLPERSISTENT

    
    

    
    
    

    

  END SUBROUTINE FIELD_3IM_WRAP

  SUBROUTINE FIELD_3IM_OWNER_INIT (SELF, LBOUNDS, UBOUNDS, PERSISTENT, DELAYED)
    CLASS(FIELD_3IM_OWNER) :: SELF
    INTEGER(KIND=JPIM), INTENT(IN), OPTIONAL :: LBOUNDS(3)
    INTEGER(KIND=JPIM), INTENT(IN) :: UBOUNDS(3)
    LOGICAL, OPTIONAL,  INTENT(IN) :: PERSISTENT
    LOGICAL, OPTIONAL,  INTENT(IN) :: DELAYED
    LOGICAL :: IS_DELAYED

    
    

    
    
    

    
    

    

    

    
    
  END SUBROUTINE FIELD_3IM_OWNER_INIT

  SUBROUTINE FIELD_3IM_ALLOCATE (SELF)
    
    CLASS(FIELD_3IM_OWNER) :: SELF

    
    
  END SUBROUTINE FIELD_3IM_ALLOCATE

  FUNCTION FIELD_3IM_GET_VIEW(SELF, BLOCK_INDEX, ZERO) RESULT(VIEW_PTR)
    CLASS(FIELD_3IM) :: SELF
    INTEGER(KIND=JPIM), POINTER :: VIEW_PTR(:,:)
    INTEGER(KIND=JPIM), INTENT(IN) :: BLOCK_INDEX
    LOGICAL, OPTIONAL,  INTENT(IN) :: ZERO
    INTEGER(KIND=JPIM) :: IDX
    INTEGER(KIND=JPIM) :: LBOUNDS(3)

    
    

    
    

    
  END FUNCTION FIELD_3IM_GET_VIEW

  SUBROUTINE FIELD_3IM_DELETE_DEVICE(SELF)
    
    CLASS(FIELD_3IM) :: SELF

    
  END SUBROUTINE FIELD_3IM_DELETE_DEVICE

  SUBROUTINE FIELD_3IM_FINAL(SELF)
    
    CLASS(FIELD_3IM) :: SELF
    
    
  END SUBROUTINE FIELD_3IM_FINAL

  SUBROUTINE FIELD_3IM_WRAPPER_FINAL(SELF)
    
    CLASS(FIELD_3IM_WRAPPER) :: SELF
    INTEGER(KIND=JPIM), POINTER :: PTR(:,:,:)
    
    
  END SUBROUTINE FIELD_3IM_WRAPPER_FINAL

  SUBROUTINE FIELD_3IM_OWNER_FINAL(SELF)
    
    CLASS(FIELD_3IM_OWNER) :: SELF
    
    
  END SUBROUTINE FIELD_3IM_OWNER_FINAL

  SUBROUTINE FIELD_3IM_COPY_OBJECT (SELF, LDCREATED)
  CLASS(FIELD_3IM) :: SELF
  LOGICAL, INTENT (IN), OPTIONAL :: LDCREATED
  LOGICAL :: LLCREATED

  
  

  

  

  END SUBROUTINE FIELD_3IM_COPY_OBJECT

  SUBROUTINE FIELD_3IM_WIPE_OBJECT (SELF, LDDELETED)
  CLASS(FIELD_3IM) :: SELF
  LOGICAL, INTENT (IN), OPTIONAL :: LDDELETED
  LOGICAL :: LLDELETED

  
  

  

  

  END SUBROUTINE FIELD_3IM_WIPE_OBJECT

  SUBROUTINE FIELD_3IM_COPY_DATA (SELF, KDIR, QUEUE)
  CLASS(FIELD_3IM) :: SELF
  INTEGER (KIND=JPIM),           INTENT(IN) :: KDIR
  INTEGER (KIND=JPIM), OPTIONAL, INTENT(IN) :: QUEUE
  REAL :: START, FINISH

  

  
  
  
  

  

    

    

    

    


  END SUBROUTINE FIELD_3IM_COPY_DATA


  SUBROUTINE FIELD_3IM_GET_HOST_DATA (SELF, MODE, PTR, QUEUE)
    CLASS(FIELD_3IM),                INTENT(INOUT) :: SELF
    INTEGER (KIND=JPIM),           INTENT(IN)    :: MODE

    INTEGER(KIND=JPIM), POINTER,          INTENT(INOUT) :: PTR(:,:,:)
    INTEGER (KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    INTEGER(KIND=JPIM) :: LBOUNDS(3)

    
    
    
    

  END SUBROUTINE FIELD_3IM_GET_HOST_DATA

  SUBROUTINE FIELD_3IM_OWNER_GET_HOST_DATA (SELF, MODE, PTR, QUEUE)
    CLASS(FIELD_3IM_OWNER),          INTENT(INOUT) :: SELF
    INTEGER (KIND=JPIM),           INTENT(IN)    :: MODE
    INTEGER(KIND=JPIM), POINTER,          INTENT(INOUT) :: PTR(:,:,:)
    INTEGER (KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    
    

  END SUBROUTINE FIELD_3IM_OWNER_GET_HOST_DATA

  SUBROUTINE FIELD_3IM_GET_HOST_DATA_RDONLY (SELF, PPTR, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), POINTER,         INTENT(INOUT) :: PPTR(:,:,:)
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    

  END SUBROUTINE FIELD_3IM_GET_HOST_DATA_RDONLY

  SUBROUTINE FIELD_3IM_SYNC_HOST_RDONLY (SELF, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE
    INTEGER(KIND=JPIM), POINTER                        :: ZPTR(:,:,:)

    

  END SUBROUTINE FIELD_3IM_SYNC_HOST_RDONLY

  SUBROUTINE FIELD_3IM_GET_HOST_DATA_RDWR (SELF, PPTR, QUEUE)
    CLASS(FIELD_3IM),   INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), POINTER,         INTENT(INOUT) :: PPTR(:,:,:)
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    

  END SUBROUTINE FIELD_3IM_GET_HOST_DATA_RDWR

  SUBROUTINE FIELD_3IM_SYNC_HOST_RDWR (SELF, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE
    INTEGER(KIND=JPIM), POINTER                        :: ZPTR(:,:,:)

    

  END SUBROUTINE FIELD_3IM_SYNC_HOST_RDWR

  SUBROUTINE FIELD_3IM_CREATE_DEVICE_DATA (SELF)
    CLASS(FIELD_3IM), INTENT (INOUT) :: SELF
    
  END SUBROUTINE

  SUBROUTINE FIELD_3IM_GET_DEVICE_DATA (SELF, MODE, PTR, QUEUE)
    CLASS(FIELD_3IM),                INTENT(INOUT) :: SELF
    INTEGER (KIND=JPIM),           INTENT(IN)    :: MODE
    INTEGER(KIND=JPIM), POINTER,          INTENT(INOUT) :: PTR(:,:,:)
    INTEGER (KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE
    INTEGER(KIND=JPIM)                           :: LBOUNDS(3)

    
    
    
    

  END SUBROUTINE FIELD_3IM_GET_DEVICE_DATA

  SUBROUTINE FIELD_3IM_GET_DEVICE_DATA_RDONLY (SELF, PPTR, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), POINTER,         INTENT(INOUT) :: PPTR(:,:,:)
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    

  END SUBROUTINE FIELD_3IM_GET_DEVICE_DATA_RDONLY

  SUBROUTINE FIELD_3IM_SYNC_DEVICE_RDONLY (SELF, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE
    INTEGER(KIND=JPIM), POINTER                        :: ZPTR(:,:,:)

    

  END SUBROUTINE FIELD_3IM_SYNC_DEVICE_RDONLY

  SUBROUTINE FIELD_3IM_GET_DEVICE_DATA_RDWR (SELF, PPTR, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), POINTER,         INTENT(INOUT) :: PPTR(:,:,:)
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE

    

  END SUBROUTINE FIELD_3IM_GET_DEVICE_DATA_RDWR

  SUBROUTINE FIELD_3IM_SYNC_DEVICE_RDWR (SELF, QUEUE)
    CLASS(FIELD_3IM),               INTENT(INOUT) :: SELF
    INTEGER(KIND=JPIM), OPTIONAL, INTENT(IN)    :: QUEUE
    INTEGER(KIND=JPIM), POINTER                        :: ZPTR(:,:,:)

    

  END SUBROUTINE FIELD_3IM_SYNC_DEVICE_RDWR


  INTEGER (KIND=JPIM) FUNCTION FIELD_3IM_GET_LAST_CONTIGUOUS_DIMENSION (PTR) RESULT (JDIM)
  INTEGER(KIND=JPIM), POINTER :: PTR (:,:,:)
  INTEGER*8 :: ISTRIDE (3)
  INTEGER (KIND=JPIM) :: J, LB(3)

  
  
  

  
  

  

  

  

  

  

  END FUNCTION FIELD_3IM_GET_LAST_CONTIGUOUS_DIMENSION

END MODULE FIELD_3IM_MODULE
